### **项目计划：GoCoin - 一个功能完备的简化版比特币原型**

#### **一、 项目愿景 (Project Vision)**

创建一个功能完备、基于 P2P 网络的简化版比特币（Bitcoin）原型。该项目旨在通过实践，深入理解并复现一个加密货币从交易创建、全网广播、矿工打包、共识达成（PoW）到账本记录的全生命周期。

**“简化”体现在：**
*   **脚本系统**: 不实现完整的比特币脚本语言，而是使用公钥哈希直接代表地址所有权。
*   **加密算法**: 只使用核心的 `SHA-256` 和 `secp256k1`，不涉及复杂的 `OP_CHECKSIG` 等操作。
*   **网络协议**: 使用 `libp2p` 实现基础的区块和交易广播，不复现完整的比特币 P2P 消息协议。
*   **难度调整**: 使用固定的挖矿难度。

#### **二、 核心功能模块 (Core Modules)**

我们的系统将由以下几个核心模块组成：

1.  **命令行接口 (CLI)**: 用户的总入口，负责接收指令，与后端交互。
2.  **区块链核心 (Blockchain Core)**: 负责持久化存储（bbolt DB）、区块管理和共识机制（PoW）。
3.  **UTXO 集 (UTXO Set)**: 一个独立的数据库索引，用于快速查询“未花费的交易输出”，是实现查询余额和创建交易的关键。
4.  **钱包 (Wallet)**: 负责生成、管理用户的密钥对（私钥/公钥）和地址。
5.  **内存池 (Mempool)**: 一个临时的、位于内存中的交易“等候区”，新交易会先进入这里，等待被矿工打包。
6.  **P2P 网络 (P2P Network)**: 负责在多个节点间同步区块链数据和广播新交易。

#### **三、 开发路线图 (Development Roadmap)**

我们将项目分为四个主要阶段来完成：

---

**✅ 阶段一：核心引擎与基础交互 (已完成)**

*   **目标**: 搭建一个功能健全的、单机版的区块链核心，并提供基础的命令行查看功能。
*   **已完成**:
    *   [X] 完整的、包含交易的区块结构。
    *   [X] 基于 `bbolt` 的持久化存储。
    *   [X] 可工作的 PoW 共识机制（挖矿 & 验证）。
    *   [X] 基础的命令行框架。
    *   [X] **`printchain` 命令**，用于可视化地查看链上数据。
*   **当前状态**: 我们已经拥有一个强大的“发动机”和一个“仪表盘”。

---

**▶️ 阶段二：经济模型与账户体系 (进行中)**

*   **目标**: 引入账户（钱包）和账本（UTXO集）的概念，让区块链能够真正地管理“价值”。
*   **关键任务**:
    *   [X] **`createwallet` 命令**: 实现钱包功能，能够创建新的用户地址。
    *   [ ] **UTXO 集重构**: 创建一个高效的 UTXO 数据库索引。每当新区块被添加时，都需要同步更新这个索引（花掉旧的 UTXO，产生新的 UTXO）。
    *   [ ] **`getbalance --address <ADDRESS>` 命令**: 实现查询余额功能。这个命令将直接查询 UTXO 集，而不是每次都遍历整个区块链，从而获得极高的性能。
*   **当前状态**: 我们已经成功引入了**账户体系**（钱包模块），用户现在可以创建和管理自己的地址了。下一步，我们将着手建设**账本（UTXO集）**，这是实现价值查询和转移的基础。

---

**阶段三：价值流转与交易生命周期**

*   **目标**: 实现一笔交易从创建到被打包上链的完整流程。
*   **关键任务**:
    1.  **`send --from <FROM> --to <TO> --amount <AMOUNT>` 命令**: 这是项目中最复杂的核心命令。它需要：
        *   通过查询 UTXO 集，找到足够支付的“币”（未花费的输出）。
        *   使用发送方的私钥对交易进行签名。
        *   将签名后的交易放入“内存池”（Mempool）。
    2.  **整合内存池**: 修改 `MineBlock` 逻辑，使其不再接收硬编码的交易，而是从内存池中拉取待确认的交易进行打包。

---

**阶段四：去中心化与网络共识**

*   **目标**: 将单机应用扩展为多节点 P2P 网络，实现去中心化的数据同步。
*   **关键任务**:
    1.  **节点启动与发现**: 节点启动时能连接到种子节点，并发现网络中的其他对等节点。
    2.  **区块同步**: 新节点加入网络时，能够从其他节点那里同步完整的区块链数据（版本比较、`getblocks`、`inv` 消息流）。
    3.  **交易与区块广播**: 当一个节点创建了新交易或挖出了新区块，它需要将其广播到全网，让其他节点接收、验证并更新自己的账本。