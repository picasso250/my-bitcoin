### **项目计划：GoCoin - 一个功能完备的简化版比特币原型**

#### **一、 项目愿景 (Project Vision)**

创建一个功能完备、基于 P2P 网络的简化版比特币（Bitcoin）原型。该项目旨在通过实践，深入理解并复现一个加密货币从交易创建、全网广播、矿工打包、共识达成（PoW）到账本记录的全生命周期。

**“简化”体现在：**
*   **脚本系统**: 不实现完整的比特币脚本语言，而是使用公钥哈希直接代表地址所有权。
*   **加密算法**: 只使用核心的 `SHA-256` 和 `secp256k1`，不涉及复杂的 `OP_CHECKSIG` 等操作。
*   **网络协议**: 使用 `libp2p` 实现基础的区块和交易广播，不复现完整的比特币 P2P 消息协议。
*   **难度调整**: 使用固定的挖矿难度。

#### **二、 核心功能模块 (Core Modules)**

我们的系统将由以下几个核心模块组成：

1.  **命令行接口 (CLI)**: 用户的总入口，负责接收指令，与后端交互。
2.  **区块链核心 (Blockchain Core)**: 负责持久化存储（bbolt DB）、区块管理和共识机制（PoW）。
3.  **UTXO 集 (UTXO Set)**: 一个独立的数据库索引，用于快速查询“未花费的交易输出”，是实现查询余额和创建交易的关键。
4.  **钱包 (Wallet)**: 负责生成、管理用户的密钥对（私钥/公钥）和地址。
5.  **内存池 (Mempool)**: 一个临时的、位于内存中的交易“等候区”，新交易会先进入这里，等待被矿工打包。
6.  **P2P 网络 (P2P Network)**: 负责在多个节点间同步区块链数据和广播新交易。

#### **三、 开发路线图 (Development Roadmap)**

我们将项目分为四个主要阶段来完成：

---

**✅ 阶段一：核心引擎与基础交互 (已完成)**

*   **目标**: 搭建一个功能健全的、单机版的区块链核心，并提供基础的命令行查看功能。
*   **已完成**:
    *   [X] 完整的、包含交易的区块结构。
    *   [X] 基于 `bbolt` 的持久化存储。
    *   [X] 可工作的 PoW 共识机制（挖矿 & 验证）。
    *   [X] 基础的命令行框架。
    *   [X] **`printchain` 命令**，用于可视化地查看链上数据。
*   **当前状态**: 我们已经拥有一个强大的“发动机”和一个“仪表盘”。

---

**✅ 阶段二：经济模型与账户体系 (已完成)**

*   **目标**: 引入账户（钱包）和账本（UTXO集）的概念，让区块链能够真正地管理“价值”。
*   **已完成**:
    *   [X] **`createwallet` 命令**: 实现钱包功能，能够创建新的用户地址，并包含校验和。
    *   [X] **UTXO 集重构**: 创建了一个高效的 UTXO 数据库索引 (`chainstate`)，并实现了 `Reindex` 和 `Update` 逻辑。
    *   [X] **`getbalance --address <ADDRESS>` 命令**: 实现查询余额功能。此命令直接查询 UTXO 集，性能高效。
*   **当前状态**: 我们成功引入了**账户体系**和高效的**账本（UTXO集）**，为价值流转奠定了坚实基础。

---

**▶️ 阶段三：价值流转与完整交易 (进行中)**

*   **目标**: 实现一笔交易从创建、签名、广播到被打包上链的完整生命周期，精确复现UTXO模型。
*   **关键任务 (已根据教程细化)**:
    1.  **实现UTXO查找逻辑**:
        *   创建 `FindUTXOs` 函数，用于查找属于某个地址的所有未花费输出。
        *   创建 `FindSpendableOutputs` 函数，实现“凑钱”逻辑，找到足够支付特定金额的UTXO组合。 (对应教程 `step7`, `step8`)
    2.  **实现交易签名与验证**:
        *   创建 `Sign` 方法，能使用私钥对交易的哈希进行签名。
        *   创建 `Verify` 方法，能使用公钥验证交易签名的有效性，确保交易未被篡改。 (对应教程 `step2`, `step4`)
    3.  **构建完整的 `send` 命令**:
        *   该命令将集成上述所有逻辑：`FindSpendableOutputs` -> 构建输入和输出（含找零） -> 对每个输入进行 `Sign` -> 创建最终交易。 (对应教程 `step7`, `step8`)
    4.  **实现矿工费 (Miner Fees)**:
        *   在 `send` 命令中，允许 `输入总额 > 输出总额`，并将差额作为矿工费。
        *   修改 `MineBlock` 逻辑，在创建 Coinbase 交易时，将区块中所有交易的矿工费累加并奖励给矿工。 (对应教程 `step9`)
    5.  **整合内存池 (Mempool)**:
        *   创建一个内存池来存放已验证但未被打包的交易。
        *   `send` 命令将交易发送到内存池，而不是直接挖矿。
        *   `MineBlock` 从内存池中拉取交易进行打包。

---

**阶段四：去中心化与网络共识**

*   **目标**: 将单机应用扩展为多节点 P2P 网络，实现去中心化的数据同步。
*   **关键任务**:
    1.  **节点启动与发现**: 节点启动时能连接到种子节点，并发现网络中的其他对等节点。
    2.  **区块同步**: 新节点加入网络时，能够从其他节点那里同步完整的区块链数据（版本比较、`getblocks`、`inv` 消息流）。
    3.  **交易与区块广播**: 当一个节点创建了新交易或挖出了新区块，它需要将其广播到全网，让其他节点接收、验证并更新自己的账本。

---
### ✅ 阶段 3b：Channel 教学版（点对点「人肉广播」）

**目标**：把 P2P 网络进一步简化为 **两个 Goroutine**  
「交易→内存池→挖矿→上链」的完整闭环，零网络、零锁、零并发坑。

**关键任务**（10 分钟完成）：
1. 新增 `chansimu` 命令行开关；
3. Miner： 永远挖矿；
4. Sender：每 5 秒自动构建一笔随机转账（自己→自己即可，留点手续费）；

**教学收益**：
- 完全避开 TCP/节点发现/序列化等细节；
- Channel 就是「广播」，代码 30 行搞定；